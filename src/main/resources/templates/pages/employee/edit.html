<!DOCTYPE html>
<!--[if IE 8]> 
<html lang="cn" class="ie8"
 xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"> 
<![endif]-->
<!--[if !IE]><!-->
<html lang="cn" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org" >
<!--<![endif]-->
<head>
	<meta charset="utf-8" />
	<title>项目信息管理平台</title>
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />
	
	<!-- ================== BEGIN BASE CSS STYLE ================== -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
	<link th:href="@{/assets/plugins/jquery-ui/jquery-ui.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/bootstrap/css/bootstrap.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/font-awesome/css/all.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/ionicons/css/ionicons.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/animate/animate.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/css/apple/style.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/css/apple/style-responsive.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/css/apple/theme/default.css}" rel="stylesheet" id="theme" />
	<!-- ================== END BASE CSS STYLE ================== -->
	
	<!-- ================== BEGIN PAGE LEVEL STYLE ================== -->
	<link th:href="@{/assets/plugins/parsley/src/parsley.css}" rel="stylesheet" />
	<!-- ================== END PAGE LEVEL STYLE ================== -->
	
	<!-- ================== BEGIN PAGE LEVEL STYLE ================== -->
	<link th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/ionRangeSlider/css/ion.rangeSlider.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/ionRangeSlider/css/ion.rangeSlider.skinNice.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/password-indicator/css/password-indicator.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/bootstrap-combobox/css/bootstrap-combobox.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/bootstrap-select/bootstrap-select.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/jquery-tag-it/css/jquery.tagit.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/bootstrap-daterangepicker/daterangepicker.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/select2/dist/css/select2.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/bootstrap-eonasdan-datetimepicker/build/css/bootstrap-datetimepicker.min.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/bootstrap-colorpalette/css/bootstrap-colorpalette.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker-fontawesome.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker-glyphicons.css}" rel="stylesheet" />
	<link th:href="@{/assets/plugins/jstree/dist/themes/default/style.min.css}" rel="stylesheet" />
	<!-- ================== END PAGE LEVEL STYLE ================== -->
	
	<!-- ================== BEGIN BASE JS ================== -->
	<script th:src="@{/assets/plugins/pace/pace.min.js}"></script>
	<script th:src="@{/assets/plugins/jquery/jquery-3.3.1.min.js}"></script>
	<!-- ================== END BASE JS ================== -->
	<!-- ================== END PAGE LEVEL JS ================== -->
	<script type="text/javascript" th:src="@{/javascript/custom/bugbycode.js}"></script>
	
	
</head>
<body>
	<!-- begin #page-loader -->
	<div id="page-loader" class="fade show"><span class="spinner"></span></div>
	<!-- end #page-loader -->
	
	<!-- begin #page-container -->
	<div id="page-container" class="page-container fade page-sidebar-fixed page-header-fixed">
		<!-- begin #header -->
		<div th:include="pages/layout/head :: head"></div>
		<!-- end #header -->
		
		<!-- begin #sidebar -->
		<!-- 左侧菜单 -->
		<div th:include="pages/layout/left :: left('employee','employee')"></div>
		<!-- end #sidebar -->
		
		<!-- begin #content -->
		<div id="content" class="content">
			<form id="empForm" data-parsley-validate="true" th:object="${emp}" method="post" th:action="@{/} + *{id eq 0 ? 'employee/insert' : 'employee/update'}" autocomplete="off">
				<input type="hidden" th:field="*{id}" />
				<input type="hidden" name="projectGrant" value=""/>
				<!-- begin breadcrumb -->
				<ol class="breadcrumb pull-right">
					<li class="breadcrumb-item">用户管理</li>
					<li class="breadcrumb-item">
						<a data-toggle="ajax" th:href="@{/employee/query}">用户信息</a>
					</li>
					<li class="breadcrumb-item active" th:text="*{id > 0 ? '编辑用户' : '添加用户'}">
						查看用户
					</li>
				</ol>
				<!-- end breadcrumb -->
				<!-- begin page-header -->
				<h1 class="page-header">&nbsp;<small></small></h1>
				<!-- end page-header -->
				
				<!-- begin panel -->
				<div class="row">
					<div class="col-lg-6">
						<div class="panel-inverse">
							<div class="panel-heading">
								<div class="panel-heading-btn">
									
								</div>
								<h4 class="panel-title">基本信息</h4>
							</div>
							<div class="panel panel-body">
								<div class="form-group row m-b-15">
									<label class="col-form-label col-md-3">姓名 <span class="text-danger">*</span></label>
									<div class="col-md-9">
										<input type="text" name="name" th:value="*{name}" class="form-control m-b-5" 
											placeholder="请输入姓名"  data-parsley-required="true" data-parsley-required-message="请输入姓名" 
											data-parsley-length="[2,20]" data-parsley-length-message="姓名长度不能少于两个字符且不能超过二十个字符"
											data-parsley-pattern="^[A-Za-z0-9\u4e00-\u9fa5]*" data-parsley-pattern-message="姓名不能包含英文特殊字符"
											/>
									</div>
								</div>
								<div class="form-group row m-b-15">
									<label class="col-form-label col-md-3">状态</label>
									<div class="col-md-9">
										<select name="status" class="form-control m-b-5">
											<option value="1" th:selected="*{status==1 ? 'true' : 'false'}">激活</option>
											<option value="0" th:selected="*{status==0 ? 'true' : 'false'}">锁定</option>
										</select>
									</div>
								</div>
								<div class="form-group row m-b-15">
									<label class="col-form-label col-md-3">所属角色</label>
									<div class="col-md-9">
										<select id="roleId" name="roleId" class="form-control m-b-5">
											<option th:if="*{roleId ne 0}" th:value="*{roleId}" selected="selected" th:text="*{roleName}"></option>
											<option th:if="*{roleId eq 0}" th:value="*{roleId}" selected="selected" th:text="'请选择角色'"></option>
										</select>
									</div>
								</div>
								<div class="form-group row m-b-15">
									<label class="col-form-label col-md-3">Email</label>
									<div class="col-md-9">
										<input type="text" name="email" th:value="*{email}" class="form-control m-b-5" placeholder="请输入邮箱账号"
										data-parsley-type="email" data-parsley-type-message="Email格式不正确"
										data-parsley-maxlength="30" data-parsley-maxlength-message="Email长度不能超过三十个字符"
										/>
									</div>
								</div>
								<div class="row form-group m-b-10">
									<label class="col-md-3 col-form-label"></label>
									<div class="col-md-9">
										<button type="button" class="btn btn-sm btn-primary m-r-5 subdata">提交</button>
										<button type="button" class="btn btn-sm btn-default m-r-5" th:onclick="'location.href=\'' + @{/} + 'employee/query\';'">返回</button>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-6">
						<div class="panel-inverse">
							<div class="panel-heading">
								<div class="panel-heading-btn">
									
								</div>
								<h4 class="panel-title">认证信息</h4>
							</div>
							<div class="panel panel-body">
								<div class="form-group row m-b-15">
									<label class="col-form-label col-md-3">用户名 <span class="text-danger">*</span></label>
									<div class="col-md-9">
										<input type="text" id="username" name="username" th:readonly="*{id > 0}" th:value="*{username}" class="form-control m-b-5" placeholder="请输入用户名"
										data-parsley-required="true" data-parsley-required-message="请输入用户名" 
										data-parsley-length="[2,20]" data-parsley-length-message="用户名长度不能少于两个字符且不能超过二十个字符"
										data-parsley-pattern="^[A-Za-z0-9_-]*" data-parsley-pattern-message="用户名不能包含除大小写字母、数字、下划线以及横杠以外的字符"
										data-parsley-checkusername data-parsley-checkusername-message="该用户名已被使用"
										/>
									</div>
								</div>
								<div class="form-group row m-b-15">
									<label class="col-form-label col-md-3">密码 <span class="text-danger">*</span></label>
									<div class="col-md-9">
										<input type="password" id="password" name="password" class="form-control m-b-5" placeholder="请输入密码" 
										th:data-parsley-required="*{id eq 0 ? 'true' : 'false'}" data-parsley-required-message="请输入密码"
										data-parsley-maxlength="16" data-parsley-maxlength-message="密码长度不能超过十六个字符"
										/>
									</div>
								</div>
								<div class="form-group row m-b-15">
									<label class="col-form-label col-md-3">确认密码 <span class="text-danger">*</span></label>
									<div class="col-md-9">
										<input type="password" id="password2" name="password2" class="form-control m-b-5" placeholder="请确认密码" 
											data-parsley-required="false" data-parsley-required-message="请确认密码"
											data-parsley-equalto="#password" data-parsley-equalto-message="两次输入的密码不一致"
										/>
									</div>
								</div>
							</div>
						</div>
						<div class="panel-inverse">
							<div class="panel-heading">
								<div class="panel-heading-btn">
									
								</div>
								<h4 class="panel-title">项目文档授权</h4>
							</div>
							<div class="panel panel-body">
								<div class="jstree-user-checkable"></div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
		<!-- end #content -->
		
		<!-- begin scroll to top btn -->
		<a href="javascript:;" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" data-click="scroll-top"><i class="fa fa-angle-up"></i></a>
		<!-- end scroll to top btn -->
	</div>
	<!-- end page container -->
	<!-- ================== BEGIN BASE JS ================== -->
	<script th:src="@{/assets/plugins/jquery-ui/jquery-ui.min.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
	<!--[if lt IE 9]>
		<script th:src="@{/assets/crossbrowserjs/html5shiv.js}"></script>
		<script th:src="@{/assets/crossbrowserjs/respond.min.js}"></script>
		<script th:src="@{/assets/crossbrowserjs/excanvas.min.js}"></script>
	<![endif]-->
	<script th:src="@{/assets/plugins/slimscroll/jquery.slimscroll.min.js}"></script>
	<script th:src="@{/assets/plugins/js-cookie/js.cookie.js}"></script>
	<script th:src="@{/assets/js/theme/apple.min.js}"></script>
	<script th:src="@{/assets/js/apps.min.js}"></script>
	<!-- ================== END BASE JS ================== -->
	
	<!-- ================== BEGIN PAGE LEVEL JS ================== -->
	<script th:src="@{/assets/plugins/parsley/dist/parsley.js}"></script>
	<script th:src="@{/assets/plugins/highlight/highlight.common.js}"></script>
	<script th:src="@{/assets/js/demo/render.highlight.js}"></script>
	<!-- ================== END PAGE LEVEL JS ================== -->
	
	<!-- ================== BEGIN PAGE LEVEL JS ================== -->
	<script th:src="@{/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js}"></script>
	<script th:src="@{/assets/plugins/ionRangeSlider/js/ion-rangeSlider/ion.rangeSlider.min.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js}"></script>
	<script th:src="@{/assets/plugins/masked-input/masked-input.min.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js}"></script>
	<script th:src="@{/assets/plugins/password-indicator/js/password-indicator.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap-combobox/js/bootstrap-combobox.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap-select/bootstrap-select.min.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput-typeahead.js}"></script>
	<script th:src="@{/assets/plugins/jquery-tag-it/js/tag-it.min.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap-daterangepicker/moment.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap-daterangepicker/daterangepicker.js}"></script>
	<script th:src="@{/assets/plugins/select2/dist/js/select2.min.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap-eonasdan-datetimepicker/build/js/bootstrap-datetimepicker.min.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap-show-password/bootstrap-show-password.js}"></script>
	<script th:src="@{/assets/plugins/bootstrap-colorpalette/js/bootstrap-colorpalette.js}"></script>
	<script th:src="@{/assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker.js}"></script>
	<script th:src="@{/assets/plugins/clipboard/clipboard.min.js}"></script>
	<script th:src="@{/assets/plugins/jstree/dist/jstree.min.js}"></script>
	<!-- ================== END PAGE LEVEL JS ================== -->
	<script type="text/javascript" th:inline="javascript">
		var rootPath = [[@{/}]];
		
		$(".subdata").click(function(){
			var ref = $('.jstree-user-checkable').jstree(true);
			var projectIdArr = ref.get_selected(false);
			var idStr = "";
			for(var index = 0;index < projectIdArr.length;index++){
				if(index > 0){
					idStr += ",";
				}
				idStr += projectIdArr[index];
			}
			$("input[name='projectGrant']").val(idStr);
			$("#empForm").submit();
		});
		
		function select2Format(selector,url,defaultText){
			$(selector).select2({
				width:'100%',
				ajax:{
		    		type:"get",
		    		url: function (params) {
	    				var value = params.term;
	    				if(value == undefined){
	    					value = "";
	    				}
	    		      	return url + value;
	    		    },processResults:function(data,params){
	    		    	var result = [{id:0,text:defaultText}];
	    		    	$.each(data,function(index,item){
	    		    		result.push({
	    		    			id:item.id,
	    		    			text:item.name
	    		    		});
	    		    	});
	    		    	var rs = {
	   		    			results:result
	    		    	};
	    		    	return rs;
	    		    }
		    	}
			});
		}
		if([[${emp.type}]] == 1){
			select2Format("#roleId",rootPath + "employee/queryRole?roleName=","请选择角色");
		}
		
		$("#password").change(function(){
			var value = $(this).val();
			if(value != ''){
				$("#password2").attr("data-parsley-required",true);
			}else{
				$("#password2").attr("data-parsley-required",false);
			}
			$('#password2').parsley().validate();
		});
		
		window.Parsley.addValidator('checkusername',{
			validateString:function(value){
				var flag = false;
				$.ajax({
					url:rootPath + 'employee/checkUserName',
					data:'userName=' + value,
					dataType:'json',
					async:false,
					success:function(result){
						if(result.empId == 0 || result.empId == [[${emp.id}]]){
							flag = true;
						}else{
							flag = false;
						}
					}
				});
				return flag;
			}
		});
		
		$('.jstree-user-checkable').jstree({
	        'plugins': ["wholerow", "checkbox", "types"],
	        'checkbox':{
	        	"three_state":false
	        },
	        'core': {
	            "themes": {
	                "responsive": false
	            },    
	            'data': function (obj,callback){
					 $.ajax({
	                      type: "GET",
	                      url: rootPath + "employee/projectTree",
	                      data: "empId=" + [[${emp.id}]],
	                      dataType:"json",
	                      async: false,
	                      cache: false,
	                      success:function(result) {
	                    	  callback.call(this, result);
	                      }
	                 });
				}
	        },
	        "types": {
	            "default": {
	                "icon": "fa fa-folder text-primary fa-lg"
	            },
	            "file": {
	                "icon": "fa fa-file text-success fa-lg"
	            }
	        }
	    });
		
	</script>
</body>
</html>